<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ - Ø¥Ø¶Ø§ÙØ© Ù†Øµ</title>
  <script src="https://cdn.jsdelivr.net/npm/@ffmpeg/ffmpeg@0.12.6/dist/ffmpeg.min.js"></script>
  <style>
    body { font-family: sans-serif; text-align: center; margin-top: 40px; direction: rtl; }
    video { width: 80%; margin-top: 20px; border-radius: 12px; box-shadow: 0 0 10px #ccc; }
    input, button { margin: 10px; padding: 10px; font-size: 16px; }
  </style>
</head>
<body>
  <h2>ğŸ¬ Ø£Ø¶Ù Ù†Øµ Ø¥Ù„Ù‰ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</h2>

  <input type="file" id="videoFile" accept="video/*">
  <br>
  <input type="text" id="textInput" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ù†Øµ Ù‡Ù†Ø§">
  <br>
  <button id="processBtn">Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</button>

  <video id="preview" controls></video>
  <h3 id="status"></h3>

  <script>
    const { createFFmpeg, fetchFile } = FFmpeg;
    const ffmpeg = createFFmpeg({ log: true });
    const fileInput = document.getElementById('videoFile');
    const preview = document.getElementById('preview');
    const textInput = document.getElementById('textInput');
    const processBtn = document.getElementById('processBtn');
    const statusEl = document.getElementById('status');
    let file;

    // Ø¹Ø±Ø¶ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø±Ù‡
    fileInput.addEventListener('change', (e) => {
      file = e.target.files[0];
      if (file) preview.src = URL.createObjectURL(file);
    });

    processBtn.addEventListener('click', async () => {
      if (!file) return alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ÙÙŠØ¯ÙŠÙˆ Ø£ÙˆÙ„Ø§');
      if (!textInput.value) return alert('Ø§ÙƒØªØ¨ Ù†Øµ Ù„Ø¥Ø¶Ø§ÙØªÙ‡');

      statusEl.textContent = 'â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ ffmpeg ÙˆØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...';
      await ffmpeg.load();

      ffmpeg.FS('writeFile', 'input.mp4', await fetchFile(file));

      // ØªÙ†ÙÙŠØ° Ø§Ù„ÙÙ„ØªØ± Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†Øµ
      await ffmpeg.run(
        '-i', 'input.mp4',
        '-vf', `drawtext=text='${textInput.value}':fontcolor=white:fontsize=40:x=(w-text_w)/2:y=(h-text_h)/2:box=1:boxcolor=black@0.5`,
        '-c:a', 'copy',
        'output.mp4'
      );

      const data = ffmpeg.FS('readFile', 'output.mp4');
      const videoURL = URL.createObjectURL(new Blob([data.buffer], { type: 'video/mp4' }));
      preview.src = videoURL;
      statusEl.textContent = 'âœ… ØªÙ…Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¨Ù†Ø¬Ø§Ø­';
    });
  </script>
</body>
</html>
