<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ø§Ø®ØªØ¨Ø§Ø± FFMPEG ÙˆØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡</title>
  <style>
    body { background:#121212; color:#eee; font-family:monospace; text-align:center; }
    video { width:90%; margin-top:10px; border-radius:8px; }
    button, input { padding:8px 15px; border-radius:6px; margin:5px; border:none; }
    button { background:#28a745; color:white; cursor:pointer; }
    #log { white-space:pre-wrap; background:#222; color:#0f0; text-align:left; padding:10px; border-radius:10px; width:90%; margin:auto; margin-top:10px; }
  </style>
</head>
<body>
  <h2>ğŸ§  ØªØµØ­ÙŠØ­ Ø£Ø®Ø·Ø§Ø¡ FFMPEG ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­</h2>
  <input type="file" id="videoFile" accept="video/*">
  <br>
  <video id="preview" controls></video>
  <br>
  <input type="text" id="textOverlay" placeholder="Ø£Ø¯Ø®Ù„ Ù†Øµ overlay">
  <button id="processBtn">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</button>

  <div id="log">ğŸ“„ Ø§Ù„Ø³Ø¬Ù„:\n</div>

  <script src="https://cdn.jsdelivr.net/npm/@ffmpeg/ffmpeg@0.12.6/dist/ffmpeg.min.js"></script>
  <script>
    const { createFFmpeg, fetchFile } = FFmpeg;
    const ffmpeg = createFFmpeg({ log: true });
    const logBox = document.getElementById('log');
    const preview = document.getElementById('preview');
    let fileName = null;

    // Ø¹Ø±Ø¶ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨Ø¹Ø¯ Ø§Ø®ØªÙŠØ§Ø±Ù‡
    document.getElementById('videoFile').addEventListener('change', e => {
      const file = e.target.files[0];
      if (file) {
        fileName = file.name;
        preview.src = URL.createObjectURL(file);
        preview.load();
        log("âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ: " + fileName);
      }
    });

    function log(msg) {
      console.log(msg);
      logBox.textContent += "\n" + msg;
    }

    document.getElementById('processBtn').addEventListener('click', async () => {
      try {
        if (!fileName) return alert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ÙÙŠØ¯ÙŠÙˆ Ø£ÙˆÙ„Ø§Ù‹");

        const file = document.getElementById('videoFile').files[0];
        const text = document.getElementById('textOverlay').value || "Ù…Ø±Ø­Ø¨Ø§ Ø¨Ø§Ù„Ø¹Ø§Ù„Ù…";
        const outputName = "output.mp4";

        log("ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„...");
        if (!ffmpeg.isLoaded()) await ffmpeg.load();
        log("âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ FFMPEG");

        ffmpeg.FS('writeFile', fileName, await fetchFile(file));
        log("ğŸ“¦ ØªÙ… ÙƒØªØ§Ø¨Ø© Ø§Ù„Ù…Ù„Ù ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ");

        const command = [
          '-i', fileName,
          '-vf', `drawtext=text='${text}':fontcolor=white:fontsize=40:x=(w-text_w)/2:y=(h-text_h)/2`,
          '-c:a', 'copy',
          outputName
        ];

        log("ğŸ”§ Ø£Ù…Ø± Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©:\n" + command.join(" "));
        await ffmpeg.run(...command);
        log("âœ… Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©");

        const data = ffmpeg.FS('readFile', outputName);
        log("ğŸ“‚ Ø­Ø¬Ù… Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù†Ø§ØªØ¬: " + data.length + " Ø¨Ø§ÙŠØª");

        const videoUrl = URL.createObjectURL(new Blob([data.buffer], { type: 'video/mp4' }));
        preview.src = videoUrl;
        preview.load();
        log("ğŸ¬ ØªÙ… Ø¹Ø±Ø¶ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù†Ø§ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­");
      } catch (err) {
        log("âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªÙ†ÙÙŠØ°:\n" + err.message);
        console.error(err);
      }
    });
  </script>
</body>
</html>
