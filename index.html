<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>ØªØ­Ø±ÙŠØ± ÙÙŠØ¯ÙŠÙˆ Ø¨Ø³ÙŠØ·</title>
  <style>
    body { font-family: sans-serif; text-align: center; background: #121212; color: white; }
    video { max-width: 90%; margin-top: 10px; border-radius: 10px; }
    input, button { margin: 10px; padding: 8px 15px; border-radius: 8px; border: none; }
    button { background-color: #4CAF50; color: white; cursor: pointer; }
    #log { white-space: pre-line; text-align: left; max-width: 90%; margin: auto; background: #222; padding: 10px; border-radius: 10px; }
  </style>
</head>
<body>
  <h2>ğŸ¥ Ù…Ø­Ø±Ø± Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø¨Ø³ÙŠØ·</h2>

  <input type="file" id="videoFile" accept="video/*">
  <br>
  <video id="preview" controls></video>
  <br>

  <input type="text" id="textOverlay" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù†Øµ Ù‡Ù†Ø§">
  <button id="processBtn">Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</button>

  <div id="log"></div>

  <script src="https://cdn.jsdelivr.net/npm/@ffmpeg/ffmpeg@0.12.6/dist/ffmpeg.min.js"></script>
  <script>
    const { createFFmpeg, fetchFile } = FFmpeg;
    const ffmpeg = createFFmpeg({ log: true });
    const logBox = document.getElementById('log');
    const preview = document.getElementById('preview');
    let fileName = null;

    // Ø¹Ø±Ø¶ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¹Ù†Ø¯ Ø±ÙØ¹Ù‡
    document.getElementById('videoFile').addEventListener('change', e => {
      const file = e.target.files[0];
      if (file) {
        fileName = file.name;
        preview.src = URL.createObjectURL(file);
        preview.load();
      }
    });

    // Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©
    document.getElementById('processBtn').addEventListener('click', async () => {
      if (!fileName) return alert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ÙÙŠØ¯ÙŠÙˆ Ø£ÙˆÙ„Ø§Ù‹");
      const text = document.getElementById('textOverlay').value || "Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ø§Ù„Ø¹Ø§Ù„Ù…";

      logBox.innerText = "â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ ffmpeg...";
      if (!ffmpeg.isLoaded()) await ffmpeg.load();

      logBox.innerText = "âš™ï¸ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...";

      const file = document.getElementById('videoFile').files[0];
      ffmpeg.FS('writeFile', fileName, await fetchFile(file));

      const outputName = 'output.mp4';
      await ffmpeg.run(
        '-i', fileName,
        '-vf', `drawtext=text='${text}':fontcolor=white:fontsize=40:x=(w-text_w)/2:y=(h-text_h)/2`,
        '-c:a', 'copy',
        outputName
      );

      const data = ffmpeg.FS('readFile', outputName);
      const videoUrl = URL.createObjectURL(new Blob([data.buffer], { type: 'video/mp4' }));
      preview.src = videoUrl;
      logBox.innerText = "âœ… ØªÙ… Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¨Ù†Ø¬Ø§Ø­!";
    });
  </script>
</body>
</html>
